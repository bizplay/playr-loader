<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <style type="text/css">
    body { background-color: black; padding: 20px; color: #ddd; font-family: Arial; text-align: center; }
    #playr_loader_logo { display: block; margin: 100px auto 50px auto; }
    #remote_img { width: 1px; height: 1px; }
    #retry_message, #missing_channel_parameter { display: none; }
    #missing_channel_parameter { color: red; }
  </style>
  
  <script type="text/javascript" charset="utf-8">
    var tryCountdown;
    
    var loadPlayer = function() {
      if (!checkForChannelParameter()) { return false; }
      
      // Added Date param to bypass cache
      var url = "http://playr.biz/playr_loader_test_image.png?" + escape(new Date());
      var onLoad = "gotoPlayer();";
      var onError = "retryLoading();";
      document.getElementById("loaderImage").innerHTML = '<img id="remote_img" src="' + url + '" onload="' + onLoad + '" onerror="' + onError + '"/>';
    };
    
    var checkForChannelParameter = function() {
      if (queryString.channel === undefined) { 
        document.getElementById("missing_channel_parameter").style.display = "block";
        return false; 
      }
      return true;
    };
    
    var gotoPlayer = function() {
      window.location = queryString.channel;
    };
    
    var retryLoading = function() {
      var countdown = 10;
      document.getElementById("retry_message").style.display = "block";
      
      if (tryCountdown > 0) { clearInterval(tryCountdown); }
      tryCountdown = setInterval(function() {
        if (countdown >= 0) {
          document.getElementById("seconds").innerHTML = countdown; 
          countdown = countdown - 1;
        } else {
          clearInterval(tryCountdown);
          loadPlayer();
        }
      }, 1000);
    };

    var queryString = function () {
      // This function is anonymous, is executed immediately and 
      // the return value is assigned to QueryString!
      var query_string = {};
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      for (var i=0;i<vars.length;i++) {
        var pair = vars[i].split("=");
        	// If first entry with this name
        if (typeof query_string[pair[0]] === "undefined") {
          query_string[pair[0]] = pair[1];
        	// If second entry with this name
        } else if (typeof query_string[pair[0]] === "string") {
          var arr = [ query_string[pair[0]], pair[1] ];
          query_string[pair[0]] = arr;
        	// If third or later entry with this name
        } else {
          query_string[pair[0]].push(pair[1]);
        }
      } 
        return query_string;
    }();
  </script>
</head>
<body onload="loadPlayer();">
  <img id="playr_loader_logo" src="playr_loader_logo.png"/>
  <div id="retry_message"><p>Could not connect to player. Could your internet connection be down?</p><p>Retrying in <span id="seconds">0</span> seconds...</p></div>
  <div id="missing_channel_parameter"><p>The channel url is missing.</p><p>Please make sure the web address of this page ends with something like "?channel=http://playr.biz/1234/1".</p></div>

  <div id="loaderImage"></div>
</body>
</html>